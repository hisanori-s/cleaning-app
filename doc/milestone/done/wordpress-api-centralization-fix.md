# WordPress API認証・CORS問題解決作業計画

## 現状分析
- [x] 異なるアクセス方法での挙動の違いを確認
  - ブラウザ直打ち → 成功
  - React → 500エラー
  - Postman → 401エラー

## 環境情報
- WordPress: https://staging.aprilmoon.tokyo
- フロントエンド開発環境: localhost:5173（想定）
- API Secret: aiueokakikukeko

## 作業計画

### 1. WordPress側の設定調整
- [x] CORS設定の見直し
  - [x] Access-Control-Allow-Origin ヘッダーの設定確認
  - [x] プリフライトリクエスト（OPTIONS）の対応確認
  - [x] 許可するHTTPメソッドの確認
  - [x] 許可するヘッダーの確認

- [x] REST API認証設定の調整
  - [x] デフォルト認証フィルターの確認
  - [x] カスタムエンドポイントの認証設定確認
  - [x] 開発環境用の認証バイパス設定

### 2. フロントエンド側の調整
- [x] APIクライアントの設定見直し
  - [x] リクエストヘッダーの確認
  - [x] 認証トークンの設定確認
  - [x] エラーハンドリングの改善

- [x] 環境変数の確認
  - [x] API Base URLの設定確認
  - [x] エンドポイントパスの確認
  - [x] シークレットキーの設定確認

### 3. デバッグ・検証作業
- [x] リクエスト・レスポンスの詳細ログ追加
  - [x] WordPress側のログ追加
  - [x] フロントエンド側のログ追加
  - [x] ネットワークリクエストの監視

- [ ] 各アクセスパターンでのテスト
  - [ ] ブラウザ直接アクセステスト
  - [ ] Reactアプリからのアクセステスト
  - [ ] Postmanからのアクセステスト

### 4. セキュリティ対策
- [x] 本番環境を想定した設定の準備
  - [x] 適切なCORS設定
  - [x] 認証の厳格化
  - [x] エラーメッセージの適切な制御

### 5. ドキュメント化
- [x] 設定変更の記録
  - [x] WordPress側の変更内容
  - [x] フロントエンド側の変更内容
  - [x] 環境変数の設定方法

- [x] トラブルシューティングガイド
  - [x] 一般的なエラーと対処方法
  - [x] デバッグ方法の説明
  - [x] 設定確認手順

## 次のステップ
1. 変更をテストし、各アクセスパターンでの動作を確認
2. 必要に応じて追加の調整を実施
3. 本番環境への適用計画を作成

## 注意事項
- 開発環境と本番環境の設定を明確に分けました
- セキュリティを考慮しつつ、開発効率も確保しました
- 変更履歴を適切に記録しました
- テスト手順を明確化しました 