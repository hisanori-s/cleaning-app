# RoomListBox モックデータ表示 テスト実装計画

> **重要**: 
> - 既存の基本機能テストは維持したまま、モックデータ表示のテストを追加
> - テストと実装の変更は`src/__tests__`ディレクトリ内に限定
> - モックデータのハードコーディングは厳禁
> - WPエンドポイントでユーザーIDに基づく物件フィルタリングのコードは準備のみ（コメントアウト）

## 1. 要件整理

### テスト対象
- `RoomListBox`コンポーネントのモックデータ表示機能
- モックデータの取得と表示検証

### テスト要件
1. モックデータの取得と表示
   - `properties-rooms.json`の内容をそのまま表示
   - モックデータの全項目が正しく表示されること
   - データの順序が保持されていること
   - データの加工や変更を行わないこと

2. データ表示の検証
   - 取得した部屋一覧の正常表示
   - エッジケース（データなし）の処理
   - ローディング状態の表示

## 2. 作業マイルストーン

### Phase 1: テスト環境整備 ✅
- [x] モックデータ環境の確認
  - [x] `properties-rooms.json`の読み込み確認
  - [x] テスト用のヘルパー関数の作成
- [x] テストユーティリティの準備
  - [x] カスタムレンダラーの拡張
  - [x] テストヘルパー関数の実装

### Phase 2: モックデータ表示テストの実装 ✅
- [x] データ表示テスト
  - [x] モックデータの全項目表示確認
  - [x] データ順序の保持確認
  - [x] 表示形式の検証
- [x] エッジケーステスト
  - [x] データなし時の表示確認
  - [x] エラーメッセージの表示確認

### Phase 3: パフォーマンステストの実装 ✅
- [x] 表示性能テスト
  - [x] 大量データ時の表示性能確認
  - [x] メモリリーク確認
  - [x] 再レンダリング最適化確認

### Phase 4: リファクタリングとドキュメント ✅
- [x] コードのリファクタリング
  - [x] テストコードの重複排除
  - [x] テストケースの整理
  - [x] 命名の改善
- [x] ドキュメントの更新
  - [x] テストケースの説明追加
  - [x] セットアップ手順の更新
  - [x] トラブルシューティングガイドの作成

## 3. 注意事項
1. 既存の基本機能テストは維持すること
2. モックデータは`src/__tests__/mocks/api`ディレクトリで管理
3. テストの独立性を保つこと
4. 非同期処理のテストは適切なアサーションを使用
5. エラー情報は日本語で詳細に記述
6. テストカバレッジは80%以上を維持

## 4. 技術的考慮事項
- テストフレームワーク: Vitest
- UIテストライブラリ: React Testing Library
- モックデータ: JSONファイルベース（`properties-rooms.json`）

## 5. 完了条件
- [x] すべてのテストケースが実装され、パスすること
- [x] カバレッジが80%以上であること
- [x] エラーハンドリングが適切に実装されていること
- [x] モックデータが正しく表示されること
- [x] パフォーマンスが要件を満たしていること
- [x] ドキュメントが更新され、メンテナンス性が確保されていること

## 6. 実装メモ
```typescript
// TODO: ユーザーIDをベースにした物件取得のコード（将来実装用）
// src/api/wordpress.tsで実装

const fetchRooms = async (userId: number) => {
  try {
    // ローカルストレージからユーザー情報を取得
    const userInfo = localStorage.getItem('user_info');
    const user = userInfo ? JSON.parse(userInfo) : null;
    
    if (!user || !user.id) {
      throw new Error('ユーザー情報が見つかりません');
    }

    // WPエンドポイントにユーザーIDを送信してフィルタリング
    const response = await fetch(`${API_BASE_URL}/properties?user_id=${user.id}`, {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json',
      },
    });
    
    if (!response.ok) {
      throw new Error('物件情報の取得に失敗しました');
    }
    
    const data = await response.json();
    return data;
  } catch (error) {
    console.error('【エラー詳細】:', {
      説明: '物件情報取得時にエラーが発生しました',
      場所: 'fetchRooms関数',
      エラー: error.message
    });
    throw error;
  }
};
```

## 7. 将来の拡張計画
- ユーザーIDによるフィルタリング機能の実装
- WPエンドポイントの実装と連携
- パフォーマンス最適化
- エラーハンドリングの強化 